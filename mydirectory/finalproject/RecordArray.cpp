#include "RecordArray.h"

/******************************************************************************
 * Class 'RecordArray'
 *
 * Author/Copyright: John C. Quinn
 * Date last modified: 3 December 2014
**/

/******************************************************************************
 * Constructor
**/
RecordArray::RecordArray(int howMany, ofstream& outstream)
{
}

/******************************************************************************
 * Destructor
**/
RecordArray::~RecordArray()
{
}

/*********************************************************************
 * Accessors.
**/
/*********************************************************************
 * Method to return the number of comparisons for a bubblesort.
 *
 * @return the 'long' number of comparisons.
**/
  long RecordArray::getComparisonsBubble()
  {
    return this->comparisonsBubble;
  }

/*********************************************************************
 * Method to return the number of comparisons for a heapsort.
 *
 * @return the 'long' number of comparisons.
**/
  long RecordArray::getComparisonsHeap()
  {
    return this->comparisonsHeap;
  }

/*********************************************************************
 * Method to return the number of comparisons for an insertionsort.
 *
 * @return the 'long' number of comparisons.
**/
  long RecordArray::getComparisonsInsertion()
  {
    return this->comparisonsInsertion;
  }

/*********************************************************************
 * Method to return the number of comparisons for a quicksort.
 *
 * @return the 'long' number of comparisons.
**/
  long RecordArray::getComparisonsQuick()
  {
    return this->comparisonsQuick;
  }

/*********************************************************************
 * Method to return the number of comparisons for a var bubblesort.
 *
 * @return the 'long' number of comparisons.
**/
  long RecordArray::getComparisonsVariantBubble()
  {
    return this->comparisonsVariantBubble;
  }

/*********************************************************************
 * Method to return the actual number of elements in the array.
 *
 * @return the 'long' number of elements.
**/
  int RecordArray::getNumElts()
  {
    return this->numElts;
  }

/*********************************************************************
 * Method to return the number of swaps for a bubblesort.
 *
 * @return the 'long' number of swaps.
**/
  longg RecordArray::etSwapsBubble()
  {
    return this->swapsBubble;
  }

/*********************************************************************
 * Method to return the number of swaps for a heapsort.
 *
 * @return the 'long' number of swaps.
**/
  long RecordArray::getSwapsHeap()
  {
    return this->swapsHeap;
  }

/*********************************************************************
 * Method to return the number of swaps for an insertionsort.
 *
 * @return the 'long' number of swaps.
**/
  long RecordArray::getSwapsInsertion()
  {
    return this->swapsInsertion;
  }

/*********************************************************************
 * Method to return the number of swaps for a quicksort.
 *
 * @return the 'long' number of swaps.
**/
  long RecordArray::getSwapsQuick()
  {
    return this->swapsQuick;
  }

/*********************************************************************
 * Method to return the number of swaps for a var bubblesort.
 *
 * @return the 'long' number of swaps.
**/
  long RecordArray::getSwapsVariantBubble()
  {
    return this->swapsVariantBubble;
  }

/*********************************************************************
 * Mutators.
**/
/*********************************************************************
 * Method to increment the number of elements in the array.
**/
  void RecordArray::incNumElts()
  {
    ++(this->numElts);
  }

/*********************************************************************
 * Method to increment the number of comparisons in a bubblesort.
**/
  void RecordArray::incComparisonsBubble()
  {
    ++(this->comparisonsBubble);
  }

/*********************************************************************
 * Method to increment the number of comparisons in a heapsort.
**/
  void RecordArray::incComparisonsHeap()
  {
    ++(this->comparisonsHeap);
  }

/*********************************************************************
 * Method to increment the number of comparisons in an insertionsort.
**/
  void RecordArray::incComparisonsInsertion()
  {
    ++(this->comparisonsInsertion);
  }

/*********************************************************************
 * Method to increment the number of comparisons in a quicksort.
**/
  void RecordArray::incComparisonsQuick()
  {
    ++(this->comparisonsQuick);
  }

/*********************************************************************
 * Method to increment the number of comparisons in a var bubblesort.
**/
  void RecordArray::incComparisonsVariantBubble()
  {
    ++(this->comparisonsVariantBubble);
  }

/*********************************************************************
 * Method to increment the number of swaps in a bubblesort.
**/
  void RecordArray::incSwapsBubble()
  {
    ++(this->swapsBubble);
  }

/*********************************************************************
 * Method to increment the number of swaps in a heapsort.
**/
  void RecordArray::incSwapsHeap()
  {
    ++(this->swapsHeap);
  }

/*********************************************************************
 * Method to increment the number of swaps in an insertionsort.
**/
  void RecordArray::incSwapsInsertion()
  {
    ++(this->swapsInsertion);
  }

/*********************************************************************
 * Method to increment the number of swaps in an quicksort.
**/
  void RecordArray::incSwapsQuick()
  {
    ++(this->swapsQuick);
  }

/*********************************************************************
 * Method to increment the number of swaps in a var bubblesort.
**/
  void RecordArray::incSwapsVariantBubble()
  {
    ++(this->swapsVariantBubble);
  }

/*********************************************************************
 * Method to set the number of elements in the array.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setNumElts(int value)
  {
    this->numElts = value;
  }

/*********************************************************************
 * Method to set the number of comparisions in a bubblesort.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setComparisonsBubble(long value)
  {
    this->comparisonsBubble = value;
  }

/*********************************************************************
 * Method to set the number of comparisions in a heapsort.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setComparisonsHeap(long value)
  {
    this->comparisonsHeap = value;
  }

/*********************************************************************
 * Method to set the number of comparisions in an insertionsort.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setComparisonsInsertion(long value)
  {
    this->comparisonsInsertion = value;
  }

/*********************************************************************
 * Method to set the number of comparisions in a quicksort.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setComparisonsQuick(long value)
  {
    this->comparisonsQuick = value;
  }

/*********************************************************************
 * Method to set the number of comparisions in a var bubblesort.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setComparisonsVariantBubble(long value)
  {
    this->comparisonsVariantBubble = value;
  }

/*********************************************************************
 * Method to set the number of swaps in a bubblesort.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setSwapsBubble(long value)
  {
    this->swapsBubble = value;
  }

/*********************************************************************
 * Method to set the number of swaps in a heapsort.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setSwapsHeap(long value)
  {
    this->swapsHeap = value;
  }

/*********************************************************************
 * Method to set the number of swaps in an insertionsort.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setSwapsInsertion(long value)
  {
    this->swapsInsertion = value;
  }

/*********************************************************************
 * Method to set the number of swaps in a quicksort.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setSwapsQuick(long value)
  {
    this->swapsQuick = value;
  }

/*********************************************************************
 * Method to set the number of swaps in a var bubblesort.
 *
 * @param the 'long' value to set.
**/
  void RecordArray::setSwapsVariantBubble(long value)
  {
    this->swapsVariantBubble = value;
  }

/*********************************************************************
 * General methods.
**/

/*********************************************************************
 * Method to do the bubblesort.
**/
  void RecordArray::bubblesort()
  {
    int localSwaps;

    this->setComparisonsBubble(0);
    this->setSwapsBubble(0);

    for(int i = this->getNumElts()-2; i >= 0; --i)
    {
      localSwaps = 0;
      for(int j = 0; j <= i; ++j)
      {
        this->incComparisonsBubble();
        if(recs[j].compare(recs[j+1].getElement()) > 0)
        {
          this->swap(j,j+1);
          this->incSwapsBubble();
          ++localSwaps;
        }
      } // for(int j = 0; j <= i; ++j)

      if(localSwaps == 0)
      {
        //FileUtils.logFile.printf("early exit %d%n", i);
        //FileUtils.logFile.flush();
        break;
      }
          
    } // for(int i = this.getNumElts()-1; i >= 0; --i)

  } // public void bubblesort()

/*********************************************************************
 * Method to do the variant bubblesort.
**/
  void RecordArray::variantbubblesort()
  {
    boolean didSwap;

    this->setComparisonsVariantBubble(0);
    this->setSwapsVariantBubble(0);

    didSwap = true;
    int length = this->getNumElts()-1;
    while(didSwap)
    {
      didSwap = false;
      for(int i = 0; i < length; ++i)
      {
        this->incComparisonsVariantBubble();
        if(recs[i].compare(recs[i+1].getElement()) > 0)
        {
          this->swap(i,i+1);
          this->incSwapsVariantBubble();
          didSwap = true;
        }
      }
      --length;
    }

  } //  void variantbubblesort()

/*********************************************************************
 * Method to check that the array is in fact sorted.
**/
  void RecordArray::checkSort()
  {
    for(int i = 0; i < this->getNumElts()-1; ++i)
    {
      if(recs[i].compare(recs[i+1].getElement()) > 0)
      {
       	//Utils::outStream<<"Hue";//("%s ERROR (%d %s) (%d %s)%n",TAG,
	  //               i,recs[i].toString(),i+1,recs[i+1].toString());
        System.exit(1);
      }
    } // for(long i = 0; i < this.getNumElts()-1; ++i)
  } //  void checkSort()

/*********************************************************************
 * Method to fix the heap going down.
**/
  void RecordArray::fixHeapDown(int heapLength)
  {
    int insertSub,largerChild,leftChild,rightChild;

    insertSub = 0;
    leftChild = 2*insertSub + 1;
    rightChild = 2*insertSub + 2;

    while(heapLength >= leftChild)
    {
      largerChild = leftChild;
      if(heapLength >= rightChild)
      {
        this->incComparisonsHeap();
        if(this->recs[leftChild].compare(this->recs[rightChild].getElement()) < 0)
        {
          largerChild = rightChild;
        }
      }

      this->incComparisonsHeap();
      if(this->recs[insertSub].compare(this->recs[largerChild].getElement()) < 0)
      {
        this->incSwapsHeap();
        this->swap(insertSub,largerChild);
        insertSub = largerChild;
        leftChild = 2*insertSub + 1;
        rightChild = 2*insertSub + 2;
      }
      else
        break;

    }
  } //  void fixHeapDown(int heapLength)

/*********************************************************************
 * Method to fix the heap going up.
**/
  void RecordArray::fixHeapUp(int insertSub)
  {
    int parentSub;
    OneRecord insertRec;

    insertRec = this->recs[insertSub];
    parentSub = (insertSub-1)/2;

    while(0 < insertSub)
    {
      this->incComparisonsHeap();
      if(this->recs[parentSub].compare(insertRec.getElement()) < 0)
      {
        this->swap(insertSub,parentSub);
        this->incSwapsHeap();

        insertSub = parentSub;
        insertRec = this->recs[insertSub];
        parentSub = (insertSub-1)/2;

      }
      else
        break;

    } // while(0 < insertSub)
  } //  void fixHeapUp(long insertSub)

/*********************************************************************
 * Method to do the heapsort.
**/
  void RecordArray::heapsort()
  {
    this->setComparisonsHeap(0);
    this->setSwapsHeap(0);

    //********************************************************************
    // First we build the heap.  This uses the O(n log n) insertion
    // method and not the O(n) bottom up method, but that's ok for the
    // moment. 
    for(int i = 1; i < this->getNumElts(); ++i)
    {
      this->fixHeapUp(i);
    } // for(long i = 0; i < this.getNumElts(); ++i)

    //********************************************************************
    // Now we sort the heap.
    for(int i = this->getNumElts()-1; i >= 0; --i)
    {
      this->incSwapsHeap();
      this->swap(0,i);
      this->fixHeapDown(i-1);
    } // for(long i = this.getNumElts(); i >= 0; --i)
  } //  void heapsort() 

/*********************************************************************
 * Method to do the insertionsort.
**/
  void RecordArray::insertionsort()
  {
    int insertionSub;

    this->setComparisonsInsertion(0);
    this->setSwapsInsertion(0);
    for(int i = this->getNumElts()-2; i >= 0; --i)
    {
      insertionSub = i;
      for(int j = i+1; j < this->getNumElts(); ++j)
      {
        this->incComparisonsInsertion();
        if(recs[insertionSub].compare(recs[j].getElement()) > 0)
        {
          this->swap(insertionSub,j);
          insertionSub = j;
          this->incSwapsInsertion();
        }
        else
        {
          break;
        }
      }
    }
  } //  void insertionsort()

/*********************************************************************
 * Method to do the quicksort by recursive call to the substep.
**/
  void RecordArray::quicksort()
  {
    cout<<"You whore you forgot to fix this";
  }

/*********************************************************************
 * Method to do the quicksort.
**/
  void RecordArray::quickSortStep(int leftBound,int rightBound)
  {
    if(leftBound >= rightBound) return;

    long pivot = this->recs[rightBound].getElement();
    int leftIndex = leftBound;
    int rightIndex = rightBound - 1;
    while(leftIndex <= rightIndex)
    {

      while((leftIndex <= rightIndex) && (this->recs[leftIndex].getElement() <= pivot))
      {
        this->incComparisonsQuick();
        ++leftIndex;
      }

      while((leftIndex <= rightIndex) && (this->recs[rightIndex].getElement() >= pivot))
      {
        this->incComparisonsQuick();
        --rightIndex;
      }

      if(leftIndex < rightIndex)
      {
        this->incSwapsQuick();
        this->swap(leftIndex,rightIndex);
      } // if(leftIndex < rightIndex)

    } // while(leftIndex <= rightIndex)

    this->incSwapsQuick();
    this->swap(leftIndex,rightBound);
    quickSortStep(leftBound,leftIndex-1);
    quickSortStep(leftIndex+1,rightBound);
  } //  void quickSortStep(long leftBound,long rightBound)

/*********************************************************************
 * Method to read the array of records.
 *
 * @param inFile the 'Scanner' file from which to read.
**/
  void RecordArray::readRecordArray(scanner inFile)
  {
    this->setNumElts(0);
    while(inFile.hasNext())
    {
      OneRecord newRecord = new OneRecord();
      newRecord.readElement(inFile);
      recs[this->getNumElts()] = newRecord;
      this->incNumElts();
    } // while(inFile.hasNext())

  } //  void readRecordArray(Scanner inFile)

/*********************************************************************
 * Method to swap two records in the array.
 *
 * @param i the subscript of the first record.
 * @param j the subscript of the second record.
**/
   void RecordArray::swap(int i,int j)
  {
    OneRecord temp = new OneRecord();
    temp = recs[i];
    recs[i] = recs[j];
    recs[j] = temp;
  } //  void RecordArray::swap(int i,int j)

/*********************************************************************
 * Method to write the array of records.
**/
   void RecordArray::writeRecordArray()
  {
    String s = "";
    for(int i = 0; i < this->getNumElts(); ++i)
    {

      s = String.format("%s %6d %s%n",TAG,i,recs[i].toString());
      //FileUtils.logFile.printf("%s",s);
    } // for(long i = 0; i < this-> getNumElts(); ++i)

  } //  void RecordArray::writeRecordArray(Scanner inFile)

} //  class RecordArray

